<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø§Ø®ØªØ¨Ø§Ø± NLU</title>
    <style>
        body { font-family: Arial; padding: 20px; direction: rtl; }
        .test-box { border: 2px solid #ddd; padding: 20px; margin: 10px 0; border-radius: 8px; }
        .success { background: #e8f5e8; border-color: #4caf50; }
        .error { background: #ffebee; border-color: #f44336; }
        .info { background: #e3f2fd; border-color: #2196f3; }
        button { padding: 10px 20px; margin: 5px; font-size: 16px; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 4px; overflow-x: auto; }
        .city-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin: 15px 0; }
        .city-test { padding: 10px; background: #f0f0f0; border-radius: 5px; cursor: pointer; text-align: center; }
        .city-test:hover { background: #e0e0e0; }
    </style>
</head>
<body>
    <h1>ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± NLU - Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…Ø¯Ù†</h1>
    
    <div class="test-box info">
        <h3>ğŸ“‹ Ù‡Ø°Ø§ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± ÙŠÙØ­Øµ:</h3>
        <ul>
            <li>Ù‡Ù„ Rasa ÙŠØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…Ø¯Ù† ÙƒÙ€ entitiesØŸ</li>
            <li>Ù‡Ù„ ÙŠØ³ØªØ®Ø±Ø¬ Ø§Ù„Ù…Ø¯Ù† Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ØŸ</li>
            <li>Ù…Ø§ Ù‡Ùˆ intent Ø§Ù„Ø°ÙŠ ÙŠØªÙ… Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„ÙŠÙ‡ØŸ</li>
        </ul>
    </div>
    
    <div class="test-box">
        <h3>ğŸ¯ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…Ø¯Ù† Ø§Ù„Ù…ØºØ±Ø¨ÙŠØ©:</h3>
        <div class="city-grid">
            <div class="city-test" onclick="testNLU('Ø§Ù„Ø±Ø¨Ø§Ø·')">Ø§Ù„Ø±Ø¨Ø§Ø·</div>
            <div class="city-test" onclick="testNLU('Ø§Ù„Ø¯Ø§Ø± Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡')">Ø§Ù„Ø¯Ø§Ø± Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡</div>
            <div class="city-test" onclick="testNLU('Ù…Ø±Ø§ÙƒØ´')">Ù…Ø±Ø§ÙƒØ´</div>
            <div class="city-test" onclick="testNLU('ÙØ§Ø³')">ÙØ§Ø³</div>
            <div class="city-test" onclick="testNLU('Ø£ÙƒØ§Ø¯ÙŠØ±')">Ø£ÙƒØ§Ø¯ÙŠØ±</div>
            <div class="city-test" onclick="testNLU('Ø·Ù†Ø¬Ø©')">Ø·Ù†Ø¬Ø©</div>
        </div>
    </div>
    
    <div class="test-box">
        <h3>âœï¸ Ø§Ø®ØªØ¨Ø§Ø± ÙŠØ¯ÙˆÙŠ:</h3>
        <input type="text" id="testInput" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ù…Ø¯ÙŠÙ†Ø©..." style="width: 70%; padding: 10px;">
        <button onclick="testInputNLU()">Ø§Ø®ØªØ¨Ø§Ø±</button>
    </div>
    
    <div class="test-box">
        <h3>ğŸ“Š Ø§Ù„Ù†ØªØ§Ø¦Ø¬:</h3>
        <div id="results"></div>
    </div>
    
    <script>
        async function testNLU(text) {
            const resultsDiv = document.getElementById('results');
            
            try {
                // Ø§Ø®ØªØ¨Ø§Ø± NLU API Ù…Ø¨Ø§Ø´Ø±Ø©
                const response = await fetch('http://localhost:5005/model/parse', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({text: text})
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const data = await response.json();
                console.log('NLU Response:', data);
                
                let resultHtml = `<div style="margin: 15px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px;">`;
                resultHtml += `<h4>ğŸ” Ø§Ø®ØªØ¨Ø§Ø±: "${text}"</h4>`;
                
                // Intent
                resultHtml += `<p><strong>Intent:</strong> ${data.intent ? data.intent.name : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'} (${data.intent ? (data.intent.confidence * 100).toFixed(1) : 0}%)</p>`;
                
                // Entities
                if (data.entities && data.entities.length > 0) {
                    resultHtml += `<p><strong>Entities:</strong></p><ul>`;
                    data.entities.forEach(entity => {
                        resultHtml += `<li>${entity.entity}: "${entity.value}" (${(entity.confidence * 100).toFixed(1)}%)</li>`;
                    });
                    resultHtml += `</ul>`;
                    
                    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù†ØªÙŠØ¬Ø©
                    const hasVilleEntity = data.entities.some(e => e.entity === 'ville_depart' || e.entity === 'ville_destination' || e.entity === 'ville_hotel');
                    if (hasVilleEntity) {
                        resultHtml += `<div style="background: #e8f5e8; color: #2e7d32; padding: 10px; border-radius: 4px; margin: 10px 0;"><strong>âœ… Ù†Ø¬Ø­! ØªÙ… Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</strong></div>`;
                    } else {
                        resultHtml += `<div style="background: #ffebee; color: #c62828; padding: 10px; border-radius: 4px; margin: 10px 0;"><strong>âŒ ÙØ´Ù„! Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© ÙƒÙ€ entity</strong></div>`;
                    }
                } else {
                    resultHtml += `<p><strong>Entities:</strong> Ù„Ø§ ØªÙˆØ¬Ø¯</p>`;
                    resultHtml += `<div style="background: #ffebee; color: #c62828; padding: 10px; border-radius: 4px; margin: 10px 0;"><strong>âŒ ÙØ´Ù„! Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£ÙŠ entities</strong></div>`;
                }
                
                // Raw response
                resultHtml += `<details><summary>ğŸ“‹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙƒØ§Ù…Ù„Ø©</summary><pre>${JSON.stringify(data, null, 2)}</pre></details>`;
                resultHtml += `</div>`;
                
                resultsDiv.innerHTML = resultHtml + resultsDiv.innerHTML;
                
            } catch (error) {
                console.error('Error:', error);
                resultsDiv.innerHTML = `<div style="background: #ffebee; color: #c62828; padding: 15px; border-radius: 5px; margin: 15px 0;">
                    <strong>âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±:</strong> ${error.message}<br>
                    <small>ØªØ£ÙƒØ¯ Ù…Ù† ØªØ´ØºÙŠÙ„ Rasa Ø¹Ù„Ù‰ localhost:5005</small>
                </div>` + resultsDiv.innerHTML;
            }
        }
        
        function testInputNLU() {
            const input = document.getElementById('testInput');
            const text = input.value.trim();
            if (text) {
                testNLU(text);
                input.value = '';
            }
        }
        
        // ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„
        fetch('http://localhost:5005')
            .then(response => {
                if (response.ok) {
                    document.getElementById('results').innerHTML = '<div style="background: #e8f5e8; color: #2e7d32; padding: 10px; border-radius: 4px;">âœ… Ù…ØªØµÙ„ Ø¨Ù€ Rasa - Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±</div>';
                } else {
                    throw new Error('Connection failed');
                }
            })
            .catch(() => {
                document.getElementById('results').innerHTML = '<div style="background: #ffebee; color: #c62828; padding: 10px; border-radius: 4px;">âŒ ØºÙŠØ± Ù…ØªØµÙ„ - ØªØ£ÙƒØ¯ Ù…Ù† ØªØ´ØºÙŠÙ„ Rasa Ø¹Ù„Ù‰ localhost:5005</div>';
            });
        
        // Enter key support
        document.getElementById('testInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                testInputNLU();
            }
        });
    </script>
</body>
</html>